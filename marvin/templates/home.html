{{define "content"}}

  {{with .Marvin}}

<div ng-controller="MarvinCtrl">

  <div class="alert alert-info" ng-repeat="message in state.Messages">
    [[message]]
  </div>

  <div class="alert alert-error" ng-repeat="error in errors">
    [[error]]
  </div>

  <div class="row-fluid">

    <div class="span3">
      <h2>Activity</h2>
      <div class="alert alert-info"><strong>currently:</strong> [[state.Activity]]</div>
      <p>
	<a ng-repeat="(next, v) in state.Activities[state.Activity].Next" ng-click="updateActivity(state.Activity, next)" class="btn btn-large btn-block btn-primary" data-transition="[[next]]">[[next]] <i class="icon-play"></i></a>
      </p>
      <form ng-submit="updateActivity(state.Activity, targetActivity)" autocomplete="off">
	<fieldset>
	  <input class="input-block-level" type="text" typeahead="activity for activity in allActivities() | filter:$viewValue" ng-model="targetActivity" placeholder="activity name">
	  <input type="hidden" ng-model="state.Activity">
	  <!--<button type="submit" class="btn">Add</button>-->
	</fieldset>
      </form>
    </div>

    <div class="span3">
      <h2>Switches</h2>
      <form ng-submit="changeState()">
	{{range $k, $v := .Switch}}
	<label class="checkbox"><input type=checkbox ng-model="state.Switch['{{$k}}']" ng-change="changeState('{{$k}}', state.Switch['{{$k}}'])">{{$k}}</label>{{end}}
      </form>
    </div>

    <div class="span3">
      <h2>Lights</h2>
      <div class="alert alert-error" ng-repeat="error in state.Hue.Errors">
	[[error.Error.Description]]
      </div>
      <div class="alert alert-info">
	<strong>Last transition:</strong> [[state.LastTransition]]
      </div>
      <table class="table">
	<caption>Light groups</caption>
	<thead>
	  <tr>
	    <th>Name</th>
	    <th><i class="icon-off"></i> On</th>
	    <th><i class="icon-adjust"></i> Color</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="(name, group) in state.Hue.Datastore.groups">
	    <td>[[group.name]]</td>
	    <td ng-switch on="group.action.on">
	      <a ng-switch-when="true" class="btn btn-success" ng-click="setHue('/groups/'+name+'/action', OFF)">On</a>
	      <a ng-switch-when="false" class="btn btn-danger" ng-click="setHue('/groups/'+name+'/action', ON)">Off</a>
	    </td>
	    <td class="dropdown">
	      <a style="color: black; background-color: [[getColor(group.action)]]" class="dropdown-toggle btn btn-block btn-link">
		[[getBrightness(group.action)]]%
	      </a>
	      <ul class="dropdown-menu">
		<li ng-repeat="choice in allStates()">
		  <a ng-click="setHue('/groups/'+name+'/action', state.States[choice])">[[choice]]</a>
		</li>
	      </ul>
	    </td>
	  </tr>
	</tbody>
      </table>
      <table class="table">
	<caption>light bulbs</caption>
	<thead>
	  <tr>
	    <th>Name</th>
	    <th><i class="icon-off"></i> On</th>
	    <th><i class="icon-adjust"></i> Color</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="(name, light) in state.Hue.Datastore.lights">
	    <td>[[light.name]]</td>
	    <td ng-switch on="light.state.on">
	      <a ng-switch-when="true" class="btn btn-success" ng-click="setHue('/lights/'+name+'/state', OFF)">On</a>
	      <a ng-switch-when="false" class="btn btn-danger" ng-click="setHue('/lights/'+name+'/state', ON)">Off</a>
	    </td>
	    <td class="dropdown">
	      <a style="color: black; background-color: [[getColor(light.state)]]" class="dropdown-toggle btn btn-block btn-link">
		[[getBrightness(light.state)]]%
	      </a>
	      <ul class="dropdown-menu">
		<li ng-repeat="choice in allStates()">
		  <a ng-click="setHue('/lights/'+name+'/state', state.States[choice])">[[choice]]</a>
		</li>
	      </ul>
	    </td>
	  </tr>
	</tbody>
      </table>
      <accordion close-others="true">
	<accordion-group heading="States">
	  <table class="table table-condensed">
	    <thead>
	      <tr>
		<th>Name</th>
		<th>State</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr ng-repeat="choice in allStates()">
		<td>[[choice]]</td>
		<td>
		  <a style="color: black; background-color: [[getColor(state.States[choice])]]" class="btn btn-block btn-link" ng-click="openEditState(choice)">
		    [[getStateLabel(state.States[choice])]]
		  </a>
		</td>
	      </tr>
	    </tbody>
	  </table>
	</accordion-group>
      </accordion>
    </div>

    <div class="span3">
      <h2>Schedule</h2>
      <table class="table table-condensed table-striped">
	<thead>
	  <tr>
	    <th scope="col">Time</th>
	    <th scope="col">On</th>
	    <th scope="col">Except</th>
	    <th scope="col">Transition</th>
	  </tr>
	</thead>
	<tbody>{{range .Schedule}}
	  <tr>
	    <td>{{.When}}</td>
	    <td>{{if .On}}{{.On}}{{end}}</td>
	    <td>{{if .ExceptOn}}{{.ExceptOn}}{{end}}</td>
	    <td><a class="transition btn btn-block" data-transition="{{.What}}">{{.What}} <i class="icon-play"></i></a></td>
	  </tr>{{end}}
	</tbody>
      </table>
    </div>

  </div>

  <div class="row-fluid">

    <div class="span3">
      <h2>Presence</h2>
      <table class="table">
	<thead>
	  <tr>
	    <th>Name</th>
	    <th>Status</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="(k, v) in state.Present">
	    <td>[[k]]</td>
	    <td ng-switch on="v">
	      <span ng-switch-when="true" class="label label-success">Home</span>
	      <span ng-switch-when="false" class="label label-important">Away</span>
	      <span ng-switch-default>-</span>
	    </td>
	  </tr>
	</tbody>
      </table>
    </div>

    <div class="span3">
      <h2>Sensors</h2>
      <table class="table">
	<thead>
	  <tr>
	    <th scope="col">Name</th>
	    <th scope="col">Status</th>
	  </tr>
	</thead>
	<tbody>
	  <tr>
	    <td>Ambient Light</td>
	    <td>
	      {{if .LightSensor}}<span ng-switch on="state.DayLight">
		<span ng-switch-when="true" class="label label-success">daylight</span>
		<span ng-switch-when="false" class="label label-inverse">dark</span>
		<span ng-switch-default>-</span>
	      </span>{{else}}<span class="alert alert-warning">no ambient light sensor</span>{{end}}
	    </td>
	  </tr>
	  <tr>
	    <td>Motion</td>
	    <td>
	      {{if .MotionSensor}}
	      <span ng-switch on="state.Motion">
		<span ng-switch-when="true" class="label label-success">motion</span>
		<span ng-switch-when="false" class="label label-important">no motion</span>
		<span ng-switch-default>-</span>
	      </span>{{else}}<span class="alert alert-warning">no motion sensor</span>{{end}}
	    </td>
	  </tr>
	  </tbody>
      </table>
    </div>

    <div class="span3">
    </div>

    <div class="span3">
    </div>

  </div>

  {{end}}

<div>
{{end}}
