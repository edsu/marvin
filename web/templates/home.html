{{define "content"}}

  {{with .Marvin}}

<div ng-controller="MarvinCtrl">

  <div class="alert alert-info" ng-repeat="message in state.Messages">
    [[message]]
  </div>

  <div class="alert alert-error" ng-repeat="error in errors">
    [[error]]
  </div>

  <div class="row">

    <div class="col-lg-4">
      <h2>Activity</h2>
      <div class="alert alert-info"><small>Current:</small> <strong>[[state.Activity]]</strong></div>
      <p>
	<a ng-repeat="(next, v) in state.Activities[state.Activity].Next" ng-click="updateActivity(state.Activity, next)" class="btn btn-large btn-block btn-primary" data-transition="[[next]]">[[next]] <i class="icon-play"></i></a>
      </p>
      <form ng-submit="updateActivity(state.Activity, targetActivity)" autocomplete="off">
	<fieldset>
	  <input class="form-control col-lg-4" type="text" typeahead="activity for activity in allActivities() | filter:$viewValue" ng-model="targetActivity" placeholder="activity name">
	  <input type="hidden" ng-model="state.Activity">
	  <!--<button type="submit" class="btn">Add</button>-->
	</fieldset>
      </form>
    </div>

    <div class="col-lg-4">
      <h2>Switches</h2>
      <form ng-submit="changeState()">
	{{range $k, $v := .Switch}}
	<label class="checkbox"><input type=checkbox ng-model="state.Switch['{{$k}}']" ng-change="changeState('{{$k}}', state.Switch['{{$k}}'])">{{$k}}</label>{{end}}
      </form>
    </div>

    <div class="col-lg-4">
      <h2>Lights</h2>
      <div class="alert alert-error" ng-repeat="error in state.Hue.Errors">
	[[error.Error.Description]]
      </div>
      <table class="table">
	<caption>Light Groups</caption>
	<thead>
	  <tr>
	    <th>Name</th>
	    <th><i class="icon-off"></i> On</th>
	    <th><i class="icon-adjust"></i> Color</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="(name, group) in state.Hue.Datastore.groups">
	    <td>[[group.name]]</td>
	    <td ng-switch on="group.action.on">
	      <a ng-switch-when="true" class="btn btn-success" ng-click="setHue('/groups/'+name+'/action', OFF)">On</a>
	      <a ng-switch-when="false" class="btn btn-danger" ng-click="setHue('/groups/'+name+'/action', ON)">Off</a>
	    </td>
	    <td class="dropdown">
	      <a style="color: black; background-color: [[getColor(group.action)]]" class="dropdown-toggle">
		[[getBrightness(group.action)]]%
	      </a>
	      <ul class="dropdown-menu">
		<li ng-repeat="choice in allStates()">
		  <a ng-click="setHue('/groups/'+name+'/action', state.States[choice])"
		     style="color: black; background-color: [[getColor(state.States[choice])]]">[[choice]]</a>
		</li>
	      </ul>
	    </td>
	  </tr>
	</tbody>
      </table>
      <table class="table">
	<caption>Light Bulbs</caption>
	<thead>
	  <tr>
	    <th>Name</th>
	    <th><i class="icon-off"></i> On</th>
	    <th><i class="icon-adjust"></i> Color</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="(name, light) in state.Hue.Datastore.lights">
	    <td>[[light.name]]</td>
	    <td ng-switch on="light.state.on">
	      <a ng-switch-when="true" class="btn btn-success" ng-click="setHue('/lights/'+name+'/state', OFF)">On</a>
	      <a ng-switch-when="false" class="btn btn-danger" ng-click="setHue('/lights/'+name+'/state', ON)">Off</a>
	    </td>
	    <td class="dropdown">
	      <a style="color: black; background-color: [[getColor(light.state)]]" class="dropdown-toggle btn btn-block btn-link">
		[[getBrightness(light.state)]]%
	      </a>
	      <ul class="dropdown-menu">
		<li ng-repeat="choice in allStates()">
		  <a ng-click="setHue('/lights/'+name+'/state', state.States[choice])"
		     style="color: black; background-color: [[getColor(state.States[choice])]]">[[choice]]</a>
		</li>
	      </ul>
	    </td>
	  </tr>
	</tbody>
      </table>
    </div>

  </div>

  <div class="row">

    <div class="col-lg-6">
      <h2>Schedule</h2>
      {{template "schedule" .}}
    </div>

    <div class="col-lg-4">
      <h2>Light States</h2>
      <table class="table table-condensed">
	<thead>
	  <tr>
	    <th>Name</th>
	    <th>State</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="choice in allStates()">
	    <td>[[choice]]</td>
	    <td>
	      <a style="color: black; background-color: [[getColor(state.States[choice])]]" class="btn btn-block btn-link" ng-click="openEditState(choice)">
		[[getStateLabel(state.States[choice])]]
	      </a>
	    </td>
	  </tr>
	</tbody>
      </table>
    </div>

    <div class="col-lg-6">
      <h2>Transitions</h2>
      <div class="alert alert-info">
	<small>Last:</small> <strong>[[state.LastTransition]]</strong>
      </div>
      <table class="table table-condensed table-striped">
	<thead>
	  <tr>
	    <th scope="col">Name</th>
	    <th scope="col">Commands</th>
	  </tr>
	</thead>
	<tbody>{{range $k,$v := .Transitions}}
	  <tr>
	    <td><a class="transition btn btn-block" data-transition="{{$k}}">{{$k}} <i class="icon-play"></i></a></td>
	    <td>
	      <dl class="dl-horizontal">{{range $v.Commands}}
		<dt>{{.Address}}</dt><dd>{{.State}}</dd>{{end}}
	      </dl>
	    </td>
	  </tr>{{end}}
	</tbody>
      </table>
    </div>

  </div>

  {{end}}

<div>
{{end}}
