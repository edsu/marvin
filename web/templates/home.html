{{define "content"}}

  {{with .Marvin}}

<div ng-controller="MarvinCtrl">

  <div class="alert alert-info" ng-repeat="message in state.Messages">
    [[message]]
  </div>

  <div class="alert alert-error" ng-repeat="error in errors">
    [[error]]
  </div>

  <div class="row">

    <div class="col-12 col-sm-6 col-lg-4">
      <h2>Activity</h2>

      <form class="form-inline" ng-submit="updateActivity(state.Activity, targetActivity)" autocomplete="off">
	<span class="form-group">
	  <label for="iAm">I am:</label>
	  <span class="btn-group">
	    <button id="iAm" type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
	      [[state.Activity]] <span class="caret"></span>
	    </button>
	    <ul class="dropdown-menu">
	      <li ng-repeat="(next, v) in state.Activities[state.Activity].Next track by $index" ng-click="updateActivity(state.Activity, next)">
		<a class="btn btn-large btn-block btn-primary" data-transition="[[next]]">[[next]] <i class="icon-play"></i></a>
	      </li>
	      <li ng-repeat="(name, v) in state.Activities track by $index">
		<a ng-click="updateActivity('[[state.Activity]]', '[[name]]')">[[name]]</a>
	      </li>
	    </ul>
	    <span class="col-8 col-sm-6 col-lg-8">
	      <input class="form-control" type="text" typeahead="activity for activity in allActivities() | filter:$viewValue" ng-model="targetActivity" placeholder="activity name">
	      <input type="hidden" ng-model="state.Activity">
	      <!--<button type="submit" class="btn">Add</button>-->
	    </span>
	  </span>
	</span>

      </form>

    </div>


    <div class="col-12 col-sm-6 col-lg-4">
      <h2>Transition</h2>
      <div class="btn-group">
	<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
	  [[state.LastTransition]] <span class="caret"></span>
	</button>
	<ul class="dropdown-menu">
	  <li ng-repeat="(name, v) in state.Transitions track by $index">
	    <a ng-click="doTransition('[[name]]')">[[name]]</a>
	  </li>
	</ul>
      </div>
    </div>

    <div class="col-12 col-sm-6 col-lg-4">
      <h2>Switches</h2>
      <form ng-submit="changeState()">
	{{range $k, $v := .Switch}}
	<label class="checkbox"><input type=checkbox ng-model="state.Switch['{{$k}}']" ng-change="changeState('{{$k}}', state.Switch['{{$k}}'])">{{$k}}</label>{{end}}
      </form>
    </div>

    <div class="col-12 col-sm-6 col-lg-4">
      <h2>Lights</h2>
      <div class="alert alert-error" ng-repeat="error in state.Hue.Errors">
	[[error.Error.Description]]
      </div>

      <table class="table">
	<caption>Light Groups</caption>
	<thead>
	  <tr>
	    <th>Name</th>
	    <th><i class="icon-off"></i> State</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="(name, group) in state.Hue.Datastore.groups">
	    <td>[[group.name]]</td>
	    <td>
	      <div ng-switch on="group.action.on" class="btn-group">
		<button
		   ng-switch-when="true"
		   type="button" class="btn btn-default"
		   style="color: black; background-color: [[getColor(group.action)]]"
		   ng-click="setHue('/groups/'+name+'/action', OFF)">On</button>
		<button
		   ng-switch-when="false"
		   type="button" class="btn btn-default"
		   ng-click="setHue('/groups/'+name+'/action', ON)">Off</button>
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
		  <span class="caret"></span>
		</button>
		<ul class="dropdown-menu" role="menu">
		  <li ng-repeat="choice in allStates()">
		    <a class="btn btn-large" ng-click="setHue('/groups/'+name+'/action', state.States[choice])"
		       style="color: black; background-color: [[getColor(state.States[choice])]]">[[choice]]</a>
		  </li>
		</ul>
	      </div>
	    </td>
	  </tr>
	</tbody>
      </table>
      <table class="table">
	<caption>Light Bulbs</caption>
	<thead>
	  <tr>
	    <th>Name</th>
	    <th><i class="icon-off"></i> State</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="(name, light) in state.Hue.Datastore.lights">
	    <td>[[light.name]]</td>
	    <td>
	      <div ng-switch on="light.state.on" class="btn-group">
		<button
		   ng-switch-when="true"
		   type="button" class="btn btn-default"
		   style="color: black; background-color: [[getColor(light.state)]]"
		   ng-click="setHue('/lights/'+name+'/state', OFF)">On</button>
		<button
		   ng-switch-when="false"
		   type="button" class="btn btn-default"
		   ng-click="setHue('/lights/'+name+'/state', ON)">Off</button>
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
			style="color: black; background-color: [[getColor(light.state)]]">
		  <span class="caret"></span>
		</button>
		<ul class="dropdown-menu" role="menu">
		  <li ng-repeat="choice in allStates()">
		    <a class="btn btn-large" ng-click="setHue('/lights/'+name+'/state', state.States[choice])"
		       style="color: black; background-color: [[getColor(state.States[choice])]]">[[choice]]</a>
		  </li>
		</ul>
	      </div>
	    </td>
	  </tr>
	</tbody>
      </table>
    </div>

    <div class="col-12 col-sm-6 col-lg-4">
      <h2>Schedule</h2>
      {{template "schedule" .}}
    </div>

    <div class="col-6 col-lg-2">
      <h2>Presence</h2>
      {{template "presence" .}}
    </div>

    <div class="col-6 col-lg-2">
      <h2>Sensors</h2>
      {{template "sensors" .}}
    </div>

  </div>

  {{end}}

<div>
{{end}}
